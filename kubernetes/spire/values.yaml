nameOverride: ""

global:
  chart:
    name: "" # set at deploy time automatically, no need to ever set explicitly
    version: "" # set at deploy time automatically, no need to ever set explicitly

trustDomain: shasta

server:
  replicaCount: 3
  lbIP: "10.92.100.82"
  fqdn: spire.local
  port: 8081
  logLevel: INFO
  jwtIssuer: http://spire.local/shasta/vshastaio
  caTTL: 2160h
  svidDefaultTTL: 12h
  database: spire
  maxOpenDBConns: 20
  registrationPort: 54440
  tokenService:
    computeEntry: /compute/tenant1
    computeClusterEntry: /compute
    ncnEntry: /ncn/tenant1
    ncnClusterEntry: /ncn
    tokenTTL: 10800

  init:
    repository: gcr.io/sdlc-ops/wait-for-it
    tag: "20210322"
    pullPolicy: IfNotPresent

  init2:
    repository: dtr.dev.cray.com/baseos/alpine
    tag: 3.11.5
    pullPolicy: IfNotPresent

  image:
    repository: gcr.io/spiffe-io/spire-server
    tag: 0.12.2
    pullPolicy: IfNotPresent

  registration:
    repository: dtr.dev.cray.com/cray/cray-spire-tokens
    tag: 0.4.0
    pullPolicy: IfNotPresent

  persistentVolume:
    accessModes:
    - ReadWriteOnce
    size: 1Gi

cray-service:
  type: ""
  nameOverride: spire
  service:
    enabled: false
  sqlCluster:
    enabled: true
    instanceCount: 3
    postgresVersion: "11"
    volumeSize: 60Gi
    users:
      spire: []
    databases:
      spire: spire
    tls:
      issuer: cert-manager-issuer-common
    resources:
      limits:
        cpu: "8"
        memory: 8Gi
      requests:
        cpu: "4"
        memory: 4Gi
    waitForItJob: false
    connectionPooler:
      enabled: true
    parameters:
      idle_in_transaction_session_timeout: "5000"
      statement_timeout: "60000"
    backup:
      enabled: true
      schedule: "10 3 * * *" # Once per day at 3:10AM

tls:
  issuer: cert-manager-issuer-common

agent:
  logLevel: INFO
  wlSocket: /run/spire/vshastaio/sockets

  init:
    repository: gcr.io/sdlc-ops/wait-for-it
    tag: "20210322"
    pullPolicy: IfNotPresent

  image:
    repository: gcr.io/spiffe-io/spire-agent
    tag: 0.12.2
    pullPolicy: IfNotPresent

jwks:
  domain: vshasta.io
  uriPrefix: spire-jwks-vshastaio
  logLevel: INFO
  port: 80
  replicaCount: 3

  image:
    repository: gcr.io/spiffe-io/oidc-discovery-provider
    tag: 0.12.2
    pullPolicy: IfNotPresent

  nginx:
    repository: cache/nginx
    tag: 1.18.0
    pullPolicy: IfNotPresent

bundle:
  enabled: false
  uriPrefix: spire-bundle
  logLevel: INFO
  port: 8080
  replicaCount: 3

  image:
    repository: dtr.dev.cray.com/cray/cray-spire-bundle
    tag: 0.1.0
    pullPolicy: IfNotPresent

bss:
  endpoint: http://cray-bss.services.svc.cluster.local/boot/v1/bootparameters
  curl:
    repository: curlimages/curl
    tag: 7.73.0

ncn:
  url: https://spire-tokens.spire:54440/api/token
  filename: join_token
  path: /root/spire/conf
  init:
    repository: dtr.dev.cray.com/baseos/alpine
    tag: 3.12
  curl:
    repository: curlimages/curl
    tag: 7.73.0
  pause:
    repository: k8s.gcr.io/pause
    tag: 3.2
